<?php
session_start();
$isAuthenticated = isset($_SESSION['authenticated']) && $_SESSION['authenticated'] === true;
?>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
    <title>Aruna Bootstrap Template - Photo</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
  
    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  
    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    
    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">
  
    
    <!-- Vendor CSS Files -->
  <style>
    #upload-section { display: none; }
    .photo-container { position: relative; }
    .delete-button {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
      position: absolute;
      top: 10px;
      right: 10px;
      display: none;
    }
    .delete-button:hover { background-color: #c82333; }
  </style>
</head>

<body>
  <header id="header" class="fixed-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <h1 class="logo me-auto me-lg-0"><a href="index.html">Aruna</a></h1>
      <nav id="navbar" class="navbar order-last order-lg-0">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="project.html">Projects</a></li>
          <li><a href="education.html">Education</a></li>
          <li><a href="skill.html">Skills</a></li>
          <li><a href="membership.html">Memberships</a></li>
          <li><a class="active" href="photo.html">Photos</a></li>
          <li><a href="login.html">Login</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->
      <div class="header-social-links">
        <a href="mailto:ehos.sampath@gmail.com" class="email"><i class="bi bi-envelope-at"></i></a>
        <a href="assets/cv/CV.pdf" download="Your Name - CV.pdf" class="cv"><i class="bi bi-file-earmark-person"></i></a>
        <a href="https://www.linkedin.com/in/aruna-sampath" class="linkedin"><i class="bi bi-linkedin"></i></a>
        <a href="https://www.facebook.com/ehosaruna?mibextid=ZbWKwL" class="facebook"><i class="bi bi-facebook"></i></a>
      </div>
    </div>
  </header>

  <main id="main">
    <section id="photos" class="photos">
      <div class="section-title">
        <h2>Photos</h2>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <?php if (!$isAuthenticated) : ?>
          <button id="login-button" class="btn btn-primary mx-3" onclick="login()"> 
            <i class="bi bi-pen mx-1"></i> Edit
          </button>
        <?php endif; ?>
        <?php if ($isAuthenticated) : ?>
          <button id="logout-button" class="btn btn-danger mx-3" onclick="logout()">
            <i class="bi bi-box-arrow-in-left mx-2"></i> Logout
          </button>
          <div class="photo-upload mt-4" id="upload-section">
            <form action="forms/photo.php" method="POST" enctype="multipart/form-data">
              <input type="file" name="photo" accept="image/*" class="form-control mb-2">
              <button type="submit" name="upload" class="btn btn-primary">Upload Photo</button>
            </form>
          </div>
        <?php endif; ?>
      </div>
      <div id="photo-gallery" class="row mx-2">
        <?php
        // Fetch and display photos
        $photos = glob('uploads/*.jpg'); // Assuming images are stored in 'uploads' directory
        if (empty($photos)) {
          echo '<p>No photos available.</p>';
        } else {
          foreach ($photos as $photoUrl) {
            echo '<div class="col-4 mb-3 photo-container">';
            echo '<img src="' . $photoUrl . '" class="img-thumbnail w-100">';
            if ($isAuthenticated) {
              echo '<form action="forms/photo.php" method="POST" style="position:absolute;top:10px;right:10px;">';
              echo '<input type="hidden" name="url" value="' . $photoUrl . '">';
              echo '<button type="submit" name="delete" class="delete-button">Delete</button>';
              echo '</form>';
            }
            echo '</div>';
          }
        }
        ?>
      </div>
    </section>
  </main>

  <script>
    function login() {
      window.location.href = "login.html";
    }

    function logout() {
      window.location.href = "forms/logout.php";
    }
  </script>

<footer id="footer">
  <div class="container">
    <div class="copyright">
      &copy; Copyright <strong><span>Aruna</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
